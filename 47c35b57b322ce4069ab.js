import"./css/reset.css";import"./css/style.css";import ListBuilder from"./Builders/ListBuilder";import GoalsBuilder from"./Builders/GoalsBuilder";import StepBuilder from"./Builders/StepBuilder";import MasterList from"./MasterList";import{getMonth,getDate,parseISO,differenceInCalendarDays,differenceInYears}from"date-fns";import{EMPTY_STRING,FAILURE_SOUND,SUCCESS_SOUND,CLICK,HAMBURGER_BTN_CLASS,OVERLAY_CLASS,ACTIVE_GOAL_SIDEBAR_CLASS,LIST_SIDEBAR_CLASS,NEW_LIST_INPUT_ID,NEW_GOAL_INPUT_ID,ACTIVE,CATEGORY_CONTAINER_CLASS,LOGIN_BTN_CLASS,LOGIN_ERROR,KEYDOWN,COLOR_BLACK,NEUTRAL,COLOR_INPUT_CLASS,HIDDEN_DATE_INPUT_CLASS,CALENDAR_CLASS,CALENDAR_NOGRID_CLASS,COLOR_SELECTOR_CLASS,NO_SELECTOR_CLASS,TITLE_WRAPPER_CLASS,HIDDEN,CHANGE,DATE_INPUT_WRAPPER_CLASS,CALENDAR_MONTH_CLASS,CALENDAR_DAY_CLASS,INVALID_MONTH,DECEMBER,NOVEMBER,OCTOBER,SEPTEMBER,AUGUST,JULY,JUNE,MARCH,APRIL,FEBRUARY,JANUARY,CANCEL_COLOR_CLASS,PRESET_CLASS,KEYUP,SEARCH_BAR_CLASS,FAVOURITES_BTN_CLASS,SEARCH_RESULTS,FAVOURITES_RESULTS,PLANNED_BTN_CLASS,OVERDUE_BTN_CLASS,DUE_TODAY_CLASS,DUE_TOMORROW_BTN_CLASS,ENTER,LIST_CONTAINER_CLASS,LIST_CARD_CLASS,SWAP_BTN_CLASS,TOTAL_TASKS_WRAPPER_CLASS,TOTAL_TASKS_CLASS,DELETE_BTN_CLASS,ACTIVE_LIST_TITLE_CLASS,INCOMPLETE_CONTAINER_CLASS,COMPLETE_CONTAINER_CLASS,TODO_CARD_CLASS,TODO_CARD_TASK_WRAPPER_CLASS,TASK_TITLE_CLASS,PARENT_LIST_TITLE_CLASS,TASK_DETAILS_WRAPPER_CLASS,TASK_DUE_DATE_CLASS,PAST_DUE,TODAY,TOMORROW,WITH_IN_A_WEEK,WITH_IN_A_YEAR,MORE_THAN_A_YEAR,PAST_DUE_CLASS,PAST_DUE_MESSAGE,DUE_TODAY_MESSAGE,WITH_IN_A_WEEK_MESSAGE,WITHIN_A_YEAR_MESSAGE,MORE_THAN_A_YEAR_MESSAGE,SUB_TASKS_CLASS,TASK_NOTE_CLASS,TASK_WRAPPER_CLASS,TASK_TITLE_ID,ADD_STEP_INPUT_ID,TASK_DUE_DATE_ID,TASK_DATE_SELECT_ID,CURRENT_LABEL_COLOR_ID,CHECK_BOX_CLASS,NO_DUE_DATE_MESSAGE,SELECT_COLOR_MESSAGE,TASK_NOTE_ID,TASK_DELETE_ID,CHECK_BOX_CLASS_1,DATA_COLOR_CLASS,PRIORITY_CLASS,ACTIVE_STEPS_CONTAINER_CLASS,STEP_CARD_CLASS,STEP_DELETE_BTN_CLASS,MY_TASKS,ITALIC_HTML,NINETY_NINE,BUTTON,DIV,P,STYLE}from"./Constants";import{getMasterListFromLocalStorage,setMasterListToLocalStorage}from"./LocalStorage";function removeStep(e,t,a,r,S){e.steps.deleteItem(t),setMasterListToLocalStorage(S),r.removeChild(a)}function closeSidebar(e,t){e.classList.remove(ACTIVE),t.classList.remove(ACTIVE)}function closeListSidebar(e,t){e.classList.remove(ACTIVE),t.classList.remove(ACTIVE)}function playSound(e){e.volume=.2,e.play()}function hamburgerBtnClickEventListener(e,t,a){e.addEventListener(CLICK,(function(){t.classList.toggle(ACTIVE),a.classList.toggle(ACTIVE)}))}function overlayClickEventListener(e,t,a){e.addEventListener(CLICK,(function(){closeSidebar(e,t),closeListSidebar(e,a)}))}var DomController=function(){var e,t=new Audio(SUCCESS_SOUND),a=new Audio(FAILURE_SOUND),r=document.querySelector(HAMBURGER_BTN_CLASS),S=document.querySelector(OVERLAY_CLASS),n=document.querySelector(ACTIVE_GOAL_SIDEBAR_CLASS),L=document.querySelector(LIST_SIDEBAR_CLASS),E=document.querySelectorAll(CATEGORY_CONTAINER_CLASS),s=document.querySelector(NEW_LIST_INPUT_ID),_=document.querySelector(NEW_GOAL_INPUT_ID);function o(e,t){return e.key===ENTER&&13===e.keyCode&&t!==EMPTY_STRING&&(e.preventDefault(),!0)}function i(e){MasterList.setActiveList(e),setMasterListToLocalStorage(MasterList),c()}function A(){var e=document.querySelector(LIST_CONTAINER_CLASS);e.innerHTML=EMPTY_STRING,MasterList.items.forEach((function(t){var a=function(t){var a=document.createElement(DIV);a.classList.add(LIST_CARD_CLASS);var r=document.createElement(BUTTON);a.appendChild(r),r.classList.add(SWAP_BTN_CLASS),r.innerHTML=t.title,r.addEventListener(CLICK,(function(){i(t)}));var S=document.createElement(P);a.appendChild(S),S.classList.add(TOTAL_TASKS_WRAPPER_CLASS);var n=document.createElement(P);S.appendChild(n),n.classList.add(TOTAL_TASKS_CLASS),n.innerHTML=t.items.length>99?NINETY_NINE:t.items.length;var L=document.createElement(BUTTON);return a.appendChild(L),L.classList.add(DELETE_BTN_CLASS),L.innerHTML='<i id="task-delete" class="fa-solid fa-trash"></i>',L.addEventListener(CLICK,(function(){if(MasterList.deleteItem(t),e.removeChild(a),0===MasterList.items.length)MasterList.addItem(ListBuilder(MY_TASKS)),MasterList.setActiveList(MasterList.items[0]),c(),A();else if(MasterList.getActiveList()===t){var r=MasterList.items[MasterList.items.length-1];MasterList.setActiveList(r),c()}setMasterListToLocalStorage(MasterList)})),a}(t);e.appendChild(a)}))}function c(e){void 0===e&&(e=MasterList.getActiveList()),document.querySelector(ACTIVE_LIST_TITLE_CLASS).textContent=e.title;var r=document.querySelector(INCOMPLETE_CONTAINER_CLASS);r.innerHTML=EMPTY_STRING;var L=document.querySelector(COMPLETE_CONTAINER_CLASS);function E(e,S){var n=document.createElement(DIV);n.setAttribute(DATA_COLOR_CLASS,e.color),n.classList.add(CHECK_BOX_CLASS_1);var E=document.createElement(STYLE);return S.appendChild(E),E.innerHTML='.check-box[data-color="'.concat(e.color,'"] i {color: ').concat(e.color,"}"),c(n,e),n.addEventListener(CLICK,(function(E){E.stopPropagation(),e.toggleComplete(),c(n,e),function(e,S){S?(r.removeChild(e),L.appendChild(e),playSound(t)):(L.removeChild(e),r.appendChild(e),playSound(a))}(S,e.complete),setMasterListToLocalStorage(MasterList)})),n}function s(e){var t=document.createElement(DIV);return t.classList.add(PRIORITY_CLASS),i(t,e),t.addEventListener(CLICK,(function(a){a.stopPropagation(),e.togglePriority(),i(t,e),setMasterListToLocalStorage(MasterList)})),t}function _(e){var t=document.querySelector(ACTIVE_STEPS_CONTAINER_CLASS);t.innerHTML=EMPTY_STRING,e.steps.items.forEach((function(a){var r=function(a){var r=document.createElement(DIV);r.classList.add(STEP_CARD_CLASS);var S=document.createElement(DIV);r.appendChild(S),S.classList.add(CHECK_BOX_CLASS_1),c(S,a),S.addEventListener(CLICK,(function(e){e.stopPropagation(),a.toggleComplete(),c(S,a),setMasterListToLocalStorage(MasterList)}));var n=document.createElement(P);r.appendChild(n),n.textContent=a.title;var L=document.createElement(DIV);return r.appendChild(L),L.classList.add(STEP_DELETE_BTN_CLASS),L.innerHTML='<i class="step-delete fa-solid fa-trash"></i>',L.addEventListener(CLICK,(function(S){S.stopPropagation(),removeStep(e,a,r,t,MasterList)})),r}(a);t.appendChild(r)}))}function i(e,t){var a=t.priority;e.innerHTML=a?'<i class="fa-solid fa-star"></i>':'<i class="fa-regular fa-star"></i>'}function c(e,t){var a=t.complete;e.innerHTML=a?'<i class="complete-task fa-solid fa-circle-check"></i>':'<i class="incomplete-task fa-regular fa-circle"></i>'}L.innerHTML=EMPTY_STRING,e.items.forEach((function(t){!function a(i){var c=function(t){var a=document.createElement(DIV);a.classList.add(TODO_CARD_CLASS),a.appendChild(E(t,a));var r=document.createElement(DIV);a.appendChild(r),r.classList.add(TODO_CARD_TASK_WRAPPER_CLASS);var S=document.createElement(P);r.appendChild(S),S.classList.add(TASK_TITLE_CLASS),S.innerHTML=t.title;var n=document.createElement(DIV);if(r.appendChild(n),n.classList.add(TASK_DETAILS_WRAPPER_CLASS),t.childOf.title!==e.title){var L=document.createElement(P);n.appendChild(L),L.classList.add(PARENT_LIST_TITLE_CLASS);var _=t.childOf.title.split(EMPTY_STRING);L.textContent=_.length>24?_.splice(0,24).join(EMPTY_STRING)+"...":t.childOf.title}if(t.dueDate!==EMPTY_STRING){var o=document.createElement(P);n.appendChild(o),o.classList.add(TASK_DUE_DATE_CLASS);var i=parseISO(t.dueDate),A=differenceInCalendarDays(i,new Date);switch(function(e,t){return e<0?PAST_DUE:0===e?TODAY:1===e?TOMORROW:e<7?WITH_IN_A_WEEK:t<1?WITH_IN_A_YEAR:MORE_THAN_A_YEAR}(A,differenceInYears(i,new Date))){case PAST_DUE:o.innerHTML=PAST_DUE_MESSAGE(A),o.classList.add(PAST_DUE_CLASS);break;case TODAY:case TOMORROW:o.innerHTML=DUE_TODAY_MESSAGE;break;case WITH_IN_A_WEEK:o.innerHTML=WITH_IN_A_WEEK_MESSAGE(A);break;case WITH_IN_A_YEAR:o.innerHTML=WITHIN_A_YEAR_MESSAGE(i);break;case MORE_THAN_A_YEAR:o.innerHTML=MORE_THAN_A_YEAR_MESSAGE(i)}}if(t.steps.items.length>0){var c=document.createElement(P);n.appendChild(c),c.classList.add(SUB_TASKS_CLASS);var T=t.steps.items.reduce((function(e,t){return t.complete?e+1:e}),0);c.innerHTML=0===t.steps.items.length?EMPTY_STRING:"".concat(T,"/").concat(t.steps.items.length)}var C=document.createElement(P);return n.appendChild(C),C.classList.add(TASK_NOTE_CLASS),C.innerHTML=t.note===EMPTY_STRING?EMPTY_STRING:'<i class="fa-regular fa-pen-to-square"></i>',a.appendChild(s(t)),a}(t);c.addEventListener(CLICK,(function(){!function(e,t){var a=n.querySelector(TASK_WRAPPER_CLASS);a.innerHTML=EMPTY_STRING;var i=E(e,t);a.appendChild(i);var c=document.createElement(P);a.appendChild(c),c.id=TASK_TITLE_ID,c.textContent=e.title;var T=s(e);a.appendChild(T),_(e);var C=n.querySelector(ADD_STEP_INPUT_ID);C.value=EMPTY_STRING,C.onkeydown=function(t){o(t,C.value)&&(function(e,t){e.steps.addItem(StepBuilder(t)),setMasterListToLocalStorage(MasterList),_(e)}(e,C.value),C.value=EMPTY_STRING)};var l=n.querySelector(TASK_DUE_DATE_ID);e.dueDate===EMPTY_STRING?l.textContent=NO_DUE_DATE_MESSAGE:l.textContent=e.dueDate;var d=n.querySelector(TASK_DATE_SELECT_ID);d.value=EMPTY_STRING,d.onchange=function(){e.dueDate=d.value,l.textContent=e.dueDate,setMasterListToLocalStorage(MasterList)};var u=n.querySelector(COLOR_SELECTOR_CLASS),I=n.querySelector(COLOR_INPUT_CLASS),R=n.querySelector(CURRENT_LABEL_COLOR_ID);function N(){e.color===NEUTRAL?(R.textContent=SELECT_COLOR_MESSAGE,u.classList.add(NO_SELECTOR_CLASS)):(R.textContent="".concat(e.color.toUpperCase()),u.style.backgroundColor=e.color,I.value=e.color,u.classList.remove(NO_SELECTOR_CLASS))}I.onchange=function(){e.setColor(I.value),setMasterListToLocalStorage(MasterList),N();var r=n.querySelector(CHECK_BOX_CLASS);a.replaceChild(E(e,t),r)},N();var O=n.querySelector(TASK_NOTE_ID);O.value=EMPTY_STRING,void 0!==e.note&&(O.value=e.note),O.onchange=function(){e.note=O.value,setMasterListToLocalStorage(MasterList)},n.querySelector(TASK_DELETE_ID).onclick=function(){!function(e,t){e.childOf.deleteItem(e),setMasterListToLocalStorage(MasterList),e.complete?L.removeChild(t):r.removeChild(t),A(),closeSidebar(S,n)}(e,t)},n.classList.add(ACTIVE),S.classList.add(ACTIVE)}(t,c),S.onclick=function(){a(c)}})),void 0===i?t.complete?L.appendChild(c):r.appendChild(c):t.complete?L.replaceChild(c,i):r.replaceChild(c,i)}()}))}document.querySelector(LOGIN_BTN_CLASS).addEventListener(CLICK,(function(){return alert(LOGIN_ERROR)})),hamburgerBtnClickEventListener(r,L,S),overlayClickEventListener(S,n,L),s.addEventListener(KEYDOWN,(function(e){if(o(e,s.value)){var t=s.value;s.value=EMPTY_STRING,function(e){var t=ListBuilder(e);MasterList.addItem(t),i(t),A()}(t),setMasterListToLocalStorage(MasterList)}})),_.addEventListener(KEYDOWN,(function(e){if(o(e,_.value)){var t=_.value;_.value=EMPTY_STRING;var a=document.querySelector(HIDDEN_DATE_INPUT_CLASS),r=a.parentElement.querySelector(CALENDAR_CLASS),S=a.parentElement.querySelector(CALENDAR_NOGRID_CLASS);r.classList.add(ACTIVE),S.classList.remove(ACTIVE);var n=a.value;a.value=EMPTY_STRING,_.parentElement.parentElement.querySelector(COLOR_SELECTOR_CLASS).classList.add(NO_SELECTOR_CLASS);var L=_.parentElement.parentElement.querySelector(COLOR_INPUT_CLASS),E=NEUTRAL;L.value!=COLOR_BLACK&&(E=L.value),L.value=EMPTY_STRING,function(e,t,a){var r=MasterList.getActiveList();r.addItem(GoalsBuilder(r,e,t,a)),c()}(t,E,n),setMasterListToLocalStorage(MasterList)}})),E.forEach((function(e){e.querySelector(TITLE_WRAPPER_CLASS).addEventListener(CLICK,(function(){e.classList.toggle(HIDDEN)}))})),document.querySelectorAll(DATE_INPUT_WRAPPER_CLASS).forEach((function(e){var t=e.querySelector(HIDDEN_DATE_INPUT_CLASS);t.addEventListener(CHANGE,(function(){var a=e.querySelector(CALENDAR_CLASS),r=e.querySelector(CALENDAR_NOGRID_CLASS),S=t.value,n=parseISO(S),L=getMonth(n),E=getDate(n);e.querySelector(CALENDAR_MONTH_CLASS).textContent=function(e){var t;switch(e){case 0:t=JANUARY;break;case 1:t=FEBRUARY;break;case 2:t=MARCH;break;case 3:t=APRIL;break;case 4:t=MAY;break;case 5:t=JUNE;break;case 6:t=JULY;break;case 7:t=AUGUST;break;case 8:t=SEPTEMBER;break;case 9:t=OCTOBER;break;case 10:t=NOVEMBER;break;case 11:t=DECEMBER;break;default:t=INVALID_MONTH}return t}(L),e.querySelector(CALENDAR_DAY_CLASS).textContent=E,a.classList.remove(ACTIVE),r.classList.add(ACTIVE)}))})),document.querySelectorAll(COLOR_SELECTOR_CLASS).forEach((function(e){var t=e.querySelector(COLOR_INPUT_CLASS),a=e.querySelector(CANCEL_COLOR_CLASS),r=new Event(CHANGE);t.addEventListener(CHANGE,(function(){t.value!==COLOR_BLACK&&(e.style.backgroundColor=t.value,e.classList.remove(NO_SELECTOR_CLASS))})),a.addEventListener(CLICK,(function(){t.value=COLOR_BLACK,e.classList.add(NO_SELECTOR_CLASS),t.dispatchEvent(r)})),e.querySelectorAll(PRESET_CLASS).forEach((function(a){a.style.backgroundColor=a.dataset.color,a.addEventListener(CLICK,(function(S){e.blur(),e.style.backgroundColor=a.dataset.color,e.classList.remove(NO_SELECTOR_CLASS),t.value=S.target.dataset.color,t.dispatchEvent(r)}))}))})),(e=document.querySelector(SEARCH_BAR_CLASS)).addEventListener(KEYUP,(function(){var t=function(e){var t=ListBuilder(SEARCH_RESULTS);return MasterList.items.forEach((function(a){a.items.forEach((function(a){a.title.toLowerCase().includes(e)&&t.addItem(a)}))})),t}(e.value.toLowerCase());e.value===EMPTY_STRING?c():c(t)})),document.querySelector(FAVOURITES_BTN_CLASS).addEventListener(CLICK,(function(){var e;c((e=ListBuilder(FAVOURITES_RESULTS),MasterList.items.forEach((function(t){t.items.forEach((function(t){t.priority&&e.addItem(t)}))})),e))})),function(){var e=document.querySelector(PLANNED_BTN_CLASS),t=document.querySelector(OVERDUE_BTN_CLASS),a=document.querySelector(DUE_TODAY_CLASS),r=document.querySelector(DUE_TOMORROW_BTN_CLASS);function S(e,t){var a=ListBuilder(t),r=new Date;return MasterList.items.forEach((function(t){t.items.forEach((function(t){var S=parseISO(t.dueDate),n=differenceInCalendarDays(S,r);!Number.isNaN(n)&&(n===e||"planned"===e||"pastdue"===e&&n<0)&&a.addItem(t)}))})),a}e.addEventListener(CLICK,(function(){c(S("planned","Planned"))})),t.addEventListener(CLICK,(function(){c(S("pastdue","Past Due"))})),a.addEventListener(CLICK,(function(){c(S(0,"Due Today"))})),r.addEventListener(CLICK,(function(){c(S(1,"Due Tomorrow"))}))}(),getMasterListFromLocalStorage(MasterList),A(),c()}();